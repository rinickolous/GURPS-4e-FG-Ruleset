<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
	<windowclass name="item">
		<frame>recordsheet</frame>
		<placement>
			<size width="400" height="400" />
		</placement>
		<sizelimits>
			<minimum width="400" height="400" />
			<dynamic />
		</sizelimits>
		<minimize>minimized_item</minimize>
		<nodelete />
		<playercontrol />
		<sharable />
		<tooltip field="name" />
		<script file="campaign/scripts/item.lua" />
		<sheetdata>
			<sub_record_header name="header">
				<class>item_header</class>
			</sub_record_header>

			<frame_record_content name="contentframe" />

			<subwindow_record name="main">
				<class>item_main</class>
				<activate />
			</subwindow_record>

			<scrollbar_record>
				<target>main</target>
			</scrollbar_record>

			<resize_recordsheet />
			<close_recordsheet />
		</sheetdata>
	</windowclass>
	
	<windowclass name="item_main">
		<margins control="0,0,0,2" />
		<script file="campaign/scripts/item_main.lua" />
		<sheetdata>
			<anchor_column name="columnanchor" />

			<label_column name="nonid_name_label">
				<static textres="item_label_unidentified" />
			</label_column>
			<string_columnh name="nonid_name" />
			
			<label_column name="nonid_notes_label">
				<static textres="item_label_unidentifiednotes" />
			</label_column>
			<string_columnh name="nonid_notes" />

			<line_column name="divider1" />

			<label_column name="type_label">
				<static textres="item_label_type" />
			</label_column>
			<combobox_column name="type">
				<delaykeyupdate />
				<script>
					function onInit()
						super.onInit();
						addItems(DataCommonGURPS.aItemTypeData);
					end
					function onValueChanged()
						window.update();
					end
				</script>
				<unsorted />
			</combobox_column>
      
			<label_column name="subtype_label">
				<static textres="item_label_subtype" />
			</label_column>
			<string_columnh name="subtype">
				<delaykeyupdate />
				<script>
					function onValueChanged()
						window.update();
					end
				</script>
			</string_columnh>

			<line_column name="divider2" />

			<label_column name="tl_label">
				<static textres="item_label_tl" />
			</label_column>
			<string_columnh name="tl" />

			<label_column name="cost_label">
				<static textres="item_label_cost" />
			</label_column>
			<string_columnh name="cost" />

			<label_column name="weight_label">
				<static textres="item_label_weight" />
			</label_column>
			<number_columnh name="weight" />

			<line_column name="divider3" />

			<label_column name="locations_label">
				<static textres="item_label_locations" />
			</label_column>
			<string_columnh name="locations" />

			<label_column name="db_label">
				<static textres="item_label_db" />
			</label_column>
			<string_columnh name="db" />

			<label_column name="dr_label">
				<static textres="item_label_dr" />
			</label_column>
			<string_columnh name="dr" />

			<label_column name="don_label">
				<static textres="item_label_don" />
			</label_column>
			<string_columnh name="don" />

			<label_column name="holdout_label">
				<static textres="item_label_holdout" />
			</label_column>
			<string_columnh name="holdout" />

			<line_column name="divider4" />

			<label_frametop name="header_modeslist">
				<anchored to="divider4">
				<top offset="5" />
				</anchored>
				<static textres="char_label_meleecombat" />
			</label_frametop>

			<genericcontrol name="bottomanchor">
				<anchored to="divider4">
					<top offset="20" />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>

			<label_columntop name="modeslist_ispacer">
				<anchored width="20" height="20" offset="-10">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
			</label_columntop>
			<label_columntop name="modes_parry_label">
				<anchored to="bottomanchor" width="30">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-20" />
				</anchored>
				<static textres="char_label_parry" />
			</label_columntop>
			<label_columntop name="modes_reach_label">
				<anchored to="bottomanchor" width="40">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<static textres="char_label_reach" />
			</label_columntop>
			<label_columntop name="modes_damage_label">
				<anchored to="bottomanchor" width="70">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<static textres="char_label_damage" />
			</label_columntop>
			<label_columntop name="modes_level_label">
				<anchored to="bottomanchor" width="20">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<static textres="char_label_level" />
			</label_columntop>
			<label_columntop name="modes_label">
				<anchored to="bottomanchor">
					<top />
					<left anchor="right" offset="5" />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<static textres="char_label_mode" />
			</label_columntop>

			<list_charmeleemode name="modeslist">
				<anchored to="bottomanchor">
					<top anchor="bottom" relation="relative" offset="15"/>
					<left parent="columnanchor" anchor="right" offset="0" />
					<right parent="bottomanchor" anchor="left" offset="-10" />
				</anchored>
				<class>item_meleemode</class>
				<noscroll />
			</list_charmeleemode>
 
  			<button_iedit name="modeslist_iedit">
				<anchored to="modeslist" position="belowright" offset="5,2" />
				<target>modeslist</target>
			</button_iedit>
			<button_iadd name="modeslist_iadd">
				<anchored to="modeslist_iedit" position="lefthigh" offset="5,0" />
				<target>modeslist</target>
				<invisible />
			</button_iadd>

			<!--
			<label_column name="damage_label">
				<static textres="item_label_damage" />
			</label_column>
			<string_columnh name="damage" />

			<label_column name="reach_label">
				<static textres="item_label_reach" />
			</label_column>
			<string_columnh name="reach" />

			<label_column name="parry_label">
				<static textres="item_label_parry" />
			</label_column>
			<string_columnh name="parry" />

			<label_column name="acc_label">
				<static textres="item_label_acc" />
			</label_column>
			<string_columnh name="acc" />

			<label_column name="range_label">
				<static textres="item_label_range" />
			</label_column>
			<string_columnh name="range" />

			<label_column name="rof_label">
				<static textres="item_label_rof" />
			</label_column>
			<string_columnh name="rof" />

			<label_column name="shots_label">
				<static textres="item_label_shots" />
			</label_column>
			<string_columnh name="shots" />

			<label_column name="st_label">
				<static textres="item_label_st" />
			</label_column>
			<string_columnh name="st" />

			<label_column name="bulk_label">
				<static textres="item_label_bulk" />
			</label_column>
			<string_columnh name="bulk" />

			<label_column name="rcl_label">
				<static textres="item_label_rcl" />
			</label_column>
			<string_columnh name="rcl" />

			<label_column name="lc_label">
				<static textres="item_label_lc" />
			</label_column>
			<string_columnh name="lc" />

			<line_column name="divider4" />
			-->
			<line_column name="divider5">
				<anchored>
					<top parent="modeslist_iedit" relation="relative" />
				</anchored>
			</line_column>

			<ft_columnh name="notes">
				<anchored>
					<top parent="divider5" />
				</anchored>
			</ft_columnh>
		</sheetdata>
	</windowclass>

	<windowclass name="item_meleemode">
		<margins control="0,0,0,2" />
		<script>
			function onInit()
				setSkillsVisible();
			end

			function update(bReadOnly)
				local vSkills = false;
				if activateskills.getValue() == 1 then
					vSkills = true and not bReadOnly;
				end
				
				if bReadOnly then
					if skillslist_iedit then
						skillslist_iedit.setValue(0);
						skillslist_iedit.setVisible(false);
					end
				else
					if skillslist_iedit then
						skillslist_iedit.setVisible(vModes);
					end
				end
				for _,w in ipairs(skillslist.getWindows()) do
					w.skilltype.setReadOnly(bReadOnly);
					w.skillname.setReadOnly(bReadOnly);
					w.attributename.setReadOnly(bReadOnly);
					w.mod.setReadOnly(bReadOnly);
				end
			end

			function setSkillsVisible()
				local v  = false;
				if activateskills.getValue() == 1 then
					v = true;
				end

				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode().getParent().getParent());
				
				skillsicon.setVisible(v);

				skills_modifier_label.setVisible(v);
				skills_name_label.setVisible(v);
				skills_type_label.setVisible(v);
				skillslist.setVisible(v);
				skillslist_iedit.setVisible(v and not bReadOnly);
				skillslist_ispacer.setVisible(v and not bReadOnly and skillslist_iedit.getValue() == 1);
				skillslist_iadd.setVisible(v and not bReadOnly and  skillslist_iedit.getValue() == 1);
				frame_skills.setVisible(v);
			end
		</script>
		<sheetdata>
		
			<genericcontrol name="rightanchor">
				<anchored height="0" width="0">
					<top />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>
			<genericcontrol name="bottomanchor">
				<anchored height="0" width="0">
					<top offset="20" />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>
			<button_idelete name="idelete">
				<anchored>
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<invisible merge="delete" />
			</button_idelete>
			
			<string_chardefensefield name="parry">
				<anchored to="rightanchor" width="30" height="20">
					<top offset="2" />
					<right anchor="left" relation="relative" offset="-10" />
				</anchored>
				<tabtarget prev="reach" />
			</string_chardefensefield>
			<string_charfield name="reach">
				<anchored to="rightanchor" width="40" height="20">
					<top offset="2" />
					<right anchor="left" relation="relative" offset="-10" />
				</anchored>
				<tabtarget next="parry" prev="damage" />
			</string_charfield>
			<string_charfield name="damage">
				<anchored to="rightanchor" width="70" height="20">
					<top offset="2" />
					<right anchor="left" relation="relative" offset="-10" />
				</anchored>
				<tabtarget next="reach" prev="name" />
			</string_charfield>
			<buttoncontrol name="activateskills">
				<anchored to="rightanchor" width="20" height="20">
					<top offset="2" />
					<right anchor="left" relation="relative" offset="-10" />
				</anchored>
				<state icon="weapon_modes" tooltipres="char_tooltip_weaponmodes" />
				<state icon="weapon_modes_down" />
				<script>
					function onValueChanged()
						window.setSkillsVisible();
					end
				</script>
			</buttoncontrol>
			<string_textlistitem name="name">
				<anchored height="20">
					<top offset="2" />
					<left offset="5" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<nodrag />
				<tabtarget next="level" />
			</string_textlistitem>

			<!-- WEAPON SKILLS SECTION-->
			<icon_detailsection name="skillsicon">
				<icon>weapon_modes_down</icon>
			</icon_detailsection>

			<label_columntop name="skillslist_ispacer">
				<anchored to="skillsicon" width="20" height="20" offset="-10">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
			</label_columntop>
			<label_columntop name="skills_modifier_label">
				<anchored to="skillsicon" width="30">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-20" />
				</anchored>
				<static textres="skills_label_modifier" />
			</label_columntop>
			<label_columntop name="skills_name_label">
				<anchored to="skillsicon" width="40">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<static textres="skills_label_name" />
			</label_columntop>
			<label_columntop name="skills_type_label">
				<anchored to="skillsicon" width="70">
					<top />
					<right parent="bottomanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<static textres="skills_label_type" />
			</label_columntop>

			<list_weaponskill name="skillslist">
				<anchored to="skills_type_label">
					<top anchor="bottom" relation="relative" />
					<left parent="skillsicon" anchor="right" offset="10" />
					<right parent="bottomanchor" anchor="left" offset="-10" />
				</anchored>
				<class>item_skill</class>
				<noscroll />
			</list_weaponskill>

			<button_iedit name="skillslist_iedit">
				<anchored to="skillslist" position="belowright" offset="5,2" />
				<target>skillslist</target>
			</button_iedit>
			<button_iadd name="skillslist_iadd">
				<anchored to="skillslist_iedit" position="lefthigh" offset="5,0" />
				<target>skillslist</target>
				<invisible />
			</button_iadd>

			<frame_detailsub name="frame_skills">
				<anchored to="bottomanchor">
					<top anchor="bottom" relation="relative" offset="5" />
					<right parent="skillslist" anchor="right" offset="10" />
					<left parent="skillslist" anchor="left" offset="-10" />
					<bottom parent="skillslist_iedit" />
				</anchored>
			</frame_detailsub>
			
		</sheetdata>
	</windowclass>

	<windowclass name="item_skill">
		<margins control="0,0,0,2" />
		<sheetdata>

			<genericcontrol name="rightanchor">
				<anchored height="0" width="0">
					<top />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>
			<button_idelete name="idelete">
				<anchored>
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<invisible merge="delete" />
			</button_idelete>

			<number_charfield name="mod">
				<anchored to="rightanchor" width="40" height="20">
					<top offset="2" />
					<right anchor="left" relation="relative" offset="-10" />
				</anchored>
			</number_charfield>
			<string_charfield name="skillname">
				<anchored to="rightanchor" width="80" height="20">
					<top offset="2" />
					<right anchor="left" relation="relative" offset="-10" />
				</anchored>
			</string_charfield>

			<combobox_dark name="attributename">
				<anchored to="rightanchor" width="80" height="20">
					<top offset="2" />
					<right anchor="left" relation="relative" offset="-10" />
				</anchored>
      			<readonly />
      			<listdirection mergerule="replace">down</listdirection>
      			<listmaxsize mergerule="replace">6</listmaxsize>
				<delaykeyupdate />
				<script>
					function onInit()
						super.onInit();
						addItems(DataCommonGURPS.aAttributeTypeData);
					end
					function onValueChanged()
						window.update();
					end
				</script>
				<unsorted />
			</combobox_dark>
			<combobox_dark name="skilltype">
				<anchored to="rightanchor" width="80" height="20">
					<top offset="2" />
					<right anchor="left" relation="relative" offset="-10" />
				</anchored>
      			<!--readonly /-->
      			<listdirection mergerule="replace">down</listdirection>
      			<listmaxsize mergerule="replace">6</listmaxsize>
				<delaykeyupdate />
				<script>
					function onInit()
						super.onInit();
						addItems(DataCommonGURPS.AWeaponSkillTypeData);
					end
					function onValueChanged()
						window.update();
					end
				</script>
				<unsorted />
			</combobox_dark>
		</sheetdata>
	</windowclass>
</root>
